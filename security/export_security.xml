<?xml version="1.0" encoding="utf-8"?>
<!--
    Security Groups & Record Rules untuk yhc_employee_export
    
    Groups:
    - group_hr_export_user: Akses dasar dashboard dan export basic
    - group_hr_export_officer: + Export data sensitif
    - group_hr_export_manager: + Export format regulasi
    
    Record Rules:
    - Pembatasan akses berdasarkan departemen
    - Proteksi data sensitif
-->
<odoo>
    <data noupdate="0">
        
        <!-- ===== CATEGORY ===== -->
        <record id="module_category_hr_export" model="ir.module.category">
            <field name="name">HR Export &amp; Analytics</field>
            <field name="description">Kategori untuk fitur export dan analytics data karyawan</field>
            <field name="sequence">15</field>
        </record>
        
        <!-- ===== SECURITY GROUPS ===== -->
        
        <!-- Group: HR Export User -->
        <record id="group_hr_export_user" model="res.groups">
            <field name="name">User</field>
            <field name="category_id" ref="module_category_hr_export"/>
            <field name="implied_ids" eval="[(4, ref('hr.group_hr_user'))]"/>
            <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
            <field name="comment">
                Akses dasar untuk:
                - Melihat dashboard analytics
                - Export data basic (tanpa data sensitif)
                - Melihat template export
            </field>
        </record>
        
        <!-- Group: HR Export Officer -->
        <record id="group_hr_export_officer" model="res.groups">
            <field name="name">Officer</field>
            <field name="category_id" ref="module_category_hr_export"/>
            <field name="implied_ids" eval="[(4, ref('group_hr_export_user'))]"/>
            <field name="comment">
                Akses tambahan untuk:
                - Export data sensitif (NIK, NPWP, rekening)
                - Membuat dan mengelola konfigurasi export
                - Membuat template export baru
            </field>
        </record>
        
        <!-- Group: HR Export Manager -->
        <record id="group_hr_export_manager" model="res.groups">
            <field name="name">Manager</field>
            <field name="category_id" ref="module_category_hr_export"/>
            <field name="implied_ids" eval="[(4, ref('group_hr_export_officer'))]"/>
            <field name="comment">
                Akses penuh untuk:
                - Semua fitur export
                - Export format regulasi (BPJS, Pajak)
                - Mengelola semua konfigurasi dan template
                - Akses audit log
            </field>
        </record>
        
        <!-- Group: Sensitive Data Access -->
        <record id="group_hr_sensitive_data" model="res.groups">
            <field name="name">Sensitive Data Access</field>
            <field name="category_id" ref="module_category_hr_export"/>
            <field name="comment">
                Akses khusus untuk data sensitif:
                - NIK, No. KK
                - Data BPJS
                - Nomor rekening bank
                - NPWP
            </field>
        </record>
        
        <!-- Group: Regulatory Export Access -->
        <record id="group_hr_regulatory_export" model="res.groups">
            <field name="name">Regulatory Export</field>
            <field name="category_id" ref="module_category_hr_export"/>
            <field name="implied_ids" eval="[(4, ref('group_hr_sensitive_data'))]"/>
            <field name="comment">
                Akses untuk export format regulasi:
                - Format BPJS Kesehatan
                - Format BPJS Ketenagakerjaan
                - Format SPT 1721-A1
                - Format WLK (Wajib Lapor Ketenagakerjaan)
            </field>
        </record>
        
        <!-- Admin users should have full access to all export features -->
        <record id="base.group_system" model="res.groups">
            <field name="implied_ids" eval="[(4, ref('group_hr_export_manager')), (4, ref('group_hr_regulatory_export'))]"/>
        </record>
        
    </data>
    
    <!-- ===== RECORD RULES ===== -->
    <data noupdate="1">
        
        <!-- Rule: Export Config - User hanya bisa lihat config sendiri -->
        <record id="rule_export_config_user" model="ir.rule">
            <field name="name">Export Config: User - Own Records Only</field>
            <field name="model_id" ref="model_hr_employee_export_config"/>
            <field name="domain_force">[('create_uid', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_hr_export_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Rule: Export Config - Officer bisa lihat semua, edit milik sendiri -->
        <record id="rule_export_config_officer_read" model="ir.rule">
            <field name="name">Export Config: Officer - Read All</field>
            <field name="model_id" ref="model_hr_employee_export_config"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_hr_export_officer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <record id="rule_export_config_officer_write" model="ir.rule">
            <field name="name">Export Config: Officer - Write Own</field>
            <field name="model_id" ref="model_hr_employee_export_config"/>
            <field name="domain_force">[('create_uid', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_hr_export_officer'))]"/>
            <field name="perm_read" eval="False"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="True"/>
        </record>
        
        <!-- Rule: Export Config - Manager full access -->
        <record id="rule_export_config_manager" model="ir.rule">
            <field name="name">Export Config: Manager - Full Access</field>
            <field name="model_id" ref="model_hr_employee_export_config"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_hr_export_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>
        
        <!-- Rule: Export Template - User read only published -->
        <record id="rule_export_template_user" model="ir.rule">
            <field name="name">Export Template: User - Read Published Only</field>
            <field name="model_id" ref="model_hr_employee_export_template"/>
            <field name="domain_force">[('is_default', '=', True)]</field>
            <field name="groups" eval="[(4, ref('group_hr_export_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Rule: Export Template - Officer can manage own -->
        <record id="rule_export_template_officer" model="ir.rule">
            <field name="name">Export Template: Officer - Manage Own</field>
            <field name="model_id" ref="model_hr_employee_export_template"/>
            <field name="domain_force">['|', ('is_default', '=', True), ('create_uid', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_hr_export_officer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>
        
        <!-- Rule: Export Template - Manager full access -->
        <record id="rule_export_template_manager" model="ir.rule">
            <field name="name">Export Template: Manager - Full Access</field>
            <field name="model_id" ref="model_hr_employee_export_template"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_hr_export_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>
        
        <!-- Rule: Audit Log - Manager only -->
        <record id="rule_export_audit_log_manager" model="ir.rule">
            <field name="name">Export Audit Log: Manager Only</field>
            <field name="model_id" ref="model_hr_employee_export_audit_log"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_hr_export_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
    </data>
</odoo>
